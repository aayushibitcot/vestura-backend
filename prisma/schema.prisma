generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int            @id @default(autoincrement())
  email     String         @unique
  password  String
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
  firstName String
  isActive  Boolean        @default(true)
  lastName  String
  phone     String
  role      String         @default("user")
  username  String         @unique
  avatar    String?
  addresses Address[]
  cart      Cart?
  orders    Order[]
  payments  Payment[]
  reviews   Review[]
  wishlist  WishlistItem[]
}

model Address {
  id        Int      @id @default(autoincrement())
  userId    Int
  street    String
  city      String
  state     String
  zipCode   String
  country   String
  isDefault Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Category {
  id          Int       @id @default(autoincrement())
  name        String    @unique
  description String?
  image       String?
  createdAt   DateTime  @default(now())
  products    Product[]
}

model Product {
  id          Int            @id @default(autoincrement())
  categoryId  Int
  name        String
  description String?
  price       Decimal        @db.Decimal(10, 2)
  discount    Decimal        @default(0) @db.Decimal(5, 2)
  stock       Int
  image       String?
  isActive    Boolean        @default(true)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  colors      String[]
  sizes       String[]
  rating      String?
  cartItems   CartItem[]
  orderItems  OrderItem[]
  category    Category       @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  reviews     Review[]
  wishlist    WishlistItem[]

  @@index([categoryId])
}

model Cart {
  id        Int        @id @default(autoincrement())
  userId    Int        @unique
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  items     CartItem[]
}

model CartItem {
  id            Int      @id @default(autoincrement())
  cartId        Int
  productId     Int
  quantity      Int
  createdAt     DateTime @default(now())
  selectedColor String?
  selectedSize  String?
  cart          Cart     @relation(fields: [cartId], references: [id], onDelete: Cascade)
  product       Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([cartId])
  @@index([productId])
}

model Order {
  id                Int            @id @default(autoincrement())
  userId            Int
  orderNumber       String         @unique
  totalAmount       Decimal        @db.Decimal(10, 2)
  status            String         @default("pending")
  paymentStatus     String         @default("unpaid")
  shippingAddress   String?
  notes             String?
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  billingAddress    String?
  couponCode        String?
  deliveryStatus    String         @default("processing")
  discount          Decimal        @default(0) @db.Decimal(10, 2)
  estimatedDelivery DateTime?
  paymentMethod     String?
  shipping          Decimal        @default(0) @db.Decimal(10, 2)
  subtotal          Decimal        @db.Decimal(10, 2)
  tax               Decimal        @default(0) @db.Decimal(10, 2)
  trackingNumber    String?
  user              User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  items             OrderItem[]
  tracking          OrderTracking?
  payment           Payment?

  @@index([userId])
}

model OrderItem {
  id            Int      @id @default(autoincrement())
  orderId       Int
  productId     Int
  quantity      Int
  price         Decimal  @db.Decimal(10, 2)
  createdAt     DateTime @default(now())
  selectedColor String?
  selectedSize  String?
  order         Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product       Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([productId])
}

model Payment {
  id              Int      @id @default(autoincrement())
  orderId         Int      @unique
  userId          Int
  amount          Decimal  @db.Decimal(10, 2)
  paymentMethod   String
  status          String   @default("pending")
  transactionId   String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  stripeSessionId String?
  order           Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([userId])
}

model OrderTracking {
  id        Int      @id @default(autoincrement())
  orderId   Int      @unique
  status    String
  location  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  order     Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
}

model Review {
  id        Int      @id @default(autoincrement())
  productId Int
  userId    Int
  rating    Int
  comment   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([userId])
}

model WishlistItem {
  id        Int      @id @default(autoincrement())
  userId    Int
  productId Int
  createdAt DateTime @default(now())
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@index([userId])
  @@index([productId])
}

model Coupon {
  id         Int      @id @default(autoincrement())
  code       String   @unique
  discount   Decimal  @db.Decimal(10, 2)
  maxUses    Int?
  usedCount  Int      @default(0)
  validFrom  DateTime
  validUntil DateTime
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
}

model Notification {
  id        Int      @id @default(autoincrement())
  userId    Int
  title     String
  message   String
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())

  @@index([userId])
}

model Contact {
  id        Int      @id @default(autoincrement())
  name      String
  email     String
  subject   String
  message   String
  status    String   @default("new")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([email])
}
