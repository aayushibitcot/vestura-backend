generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  
}
// ============================================
// USER MODEL - For Login
// ============================================

model User {
  id            Int     @id @default(autoincrement())
  username      String  @unique
  email         String  @unique
  password      String
  firstName     String
  lastName      String
  phone         String
  role          String  @default("user") // "user" or "admin"
  isActive      Boolean @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Links to other tables
  addresses     Address[]
  cart          Cart?
  orders        Order[]
  reviews       Review[]
  wishlist      WishlistItem[]
  payments      Payment[]
}

// ============================================
// ADDRESS MODEL - User Addresses
// ============================================

model Address {
  id          Int     @id @default(autoincrement())
  userId      Int
  street      String
  city        String
  state       String
  zipCode     String
  country     String
  isDefault   Boolean @default(false)
  createdAt   DateTime @default(now())

  user        User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

// ============================================
// CATEGORY MODEL - Product Categories
// ============================================

model Category {
  id          Int     @id @default(autoincrement())
  name        String  @unique
  description String?
  image       String?
  createdAt   DateTime @default(now())

  products    Product[]
}

// ============================================
// PRODUCT MODEL - All Products
// ============================================

model Product {
  id          Int     @id @default(autoincrement())
  categoryId  Int
  name        String
  description String?
  price       Decimal @db.Decimal(10, 2)
  discount    Decimal @default(0) @db.Decimal(5, 2)
  stock       Int
  image       String?
  isActive    Boolean @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  category    Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  cartItems   CartItem[]
  orderItems  OrderItem[]
  reviews     Review[]
  wishlist    WishlistItem[]

  @@index([categoryId])
}

// ============================================
// CART MODEL - Shopping Cart
// ============================================

model Cart {
  id        Int     @id @default(autoincrement())
  userId    Int     @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  items     CartItem[]
}

model CartItem {
  id        Int     @id @default(autoincrement())
  cartId    Int
  productId Int
  quantity  Int
  createdAt DateTime @default(now())

  cart      Cart    @relation(fields: [cartId], references: [id], onDelete: Cascade)
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([cartId])
  @@index([productId])
}

// ============================================
// ORDER MODEL - Customer Orders
// ============================================

model Order {
  id              Int     @id @default(autoincrement())
  userId          Int
  orderNumber     String  @unique
  totalAmount     Decimal @db.Decimal(10, 2)
  status          String  @default("pending") // pending, confirmed, shipped, delivered, cancelled
  paymentStatus   String  @default("unpaid") // unpaid, paid, refunded
  shippingAddress String?
  notes           String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  items           OrderItem[]
  payment         Payment?
  tracking        OrderTracking?

  @@index([userId])
}

model OrderItem {
  id        Int     @id @default(autoincrement())
  orderId   Int
  productId Int
  quantity  Int
  price     Decimal @db.Decimal(10, 2)
  createdAt DateTime @default(now())

  order     Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([productId])
}

// ============================================
// PAYMENT MODEL - Payment Information
// ============================================

model Payment {
  id            Int     @id @default(autoincrement())
  orderId       Int     @unique
  userId        Int
  amount        Decimal @db.Decimal(10, 2)
  paymentMethod String  // "credit_card", "debit_card", "upi", "wallet"
  status        String  @default("pending") // pending, success, failed
  transactionId String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  order         Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  user          User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([userId])
}

// ============================================
// ORDER TRACKING MODEL - Track Orders
// ============================================

model OrderTracking {
  id        Int     @id @default(autoincrement())
  orderId   Int     @unique
  status    String  // "shipped", "out_for_delivery", "delivered"
  location  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  order     Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
}

// ============================================
// REVIEW MODEL - Product Reviews
// ============================================

model Review {
  id        Int     @id @default(autoincrement())
  productId Int
  userId    Int
  rating    Int     // 1 to 5
  comment   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([userId])
}

// ============================================
// WISHLIST MODEL - Favorite Products
// ============================================

model WishlistItem {
  id        Int     @id @default(autoincrement())
  userId    Int
  productId Int
  createdAt DateTime @default(now())

  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@index([userId])
  @@index([productId])
}

// ============================================
// COUPON MODEL - Discount Codes
// ============================================

model Coupon {
  id          Int     @id @default(autoincrement())
  code        String  @unique
  discount    Decimal @db.Decimal(10, 2)
  maxUses     Int?
  usedCount   Int     @default(0)
  validFrom   DateTime
  validUntil  DateTime
  isActive    Boolean @default(true)
  createdAt   DateTime @default(now())
}

// ============================================
// NOTIFICATION MODEL - User Notifications
// ============================================

model Notification {
  id        Int     @id @default(autoincrement())
  userId    Int
  title     String
  message   String
  isRead    Boolean @default(false)
  createdAt DateTime @default(now())

  @@index([userId])
}